---
title: "Improve your plots with `ggplot2`"
subtitle: "⚔<br/>R-Ladies Barcelona Workshop"
author: "Mireia Ramos-Rodríguez"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, rladies, rladies-fonts, custom.css]
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>
---
class: inverse, center, middle

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.dim=c(5.5, 4.5), 
                      # fig.retina=2, 
                      out.width="100%",
                      dev="svg")

library(dplyr)
library(ggplot2)
library(kableExtra)
```


# What is `ggplot2`

---
class: left, top

## Why `ggplot2`?
**`ggplot2`** is a data visualization package for R developed by [Hadley Wickham](https://twitter.com/hadleywickham) that provides a structured approach to graphing. 

It is a part of the **`tidyverse`**, a collection of R packages that share an underlying design philosophy, grammar and data structures.

--

.pull-left[
### Pros
+ Standardized method for plotting.
+ Publication quality plots.
+ Allows creation of relatively complex plots with ease.
+ Dominant plotting package in R.

```{r, echo=FALSE, out.width="40%", fig.align="center"}
knitr::include_graphics("https://media.giphy.com/media/nsMPhWK6bfxHq/giphy.gif")
```
]

--

.pull-right[
### Cons
- Might be a little bit difficult to understand at the beginning.
- Sometimes you might get lost between all the things you can change.

```{r, echo=FALSE, out.width="40%", fig.align="center"}
knitr::include_graphics("https://media.giphy.com/media/2FazgxLhFpYv4t93G/giphy.gif")
```
]

---
class: left, top

## Hands on! `r icon::fa("laptop", pull="left")` 
### The dataset

```{r, eval=FALSE}
# install.packages("devtools") # Install devtools
# devtools::install_github("mireia-bioinfo/tvseries") # Install the package tvseries
# df <- tvseries::tvseries_must_watch
load("data/tvseries_must_watch.rda")
df <- tvseries_must_watch
df <- df[!is.na(df$average_rating),] # Remove rows with NA average rating
```

```{r, echo=FALSE}
df <- tvseries::tvseries_must_watch
df <- df[!is.na(df$average_rating),] # Remove rows with NA average rating
df %>%
  kable("html", row.names=FALSE) %>%
  kable_styling(font_size = 10)  %>% 
  scroll_box(height = "300px")
```

---
class: inverse, center, middle

# The grammar of `ggplot2`

<!---------------------------------------- BUILDING PLOTS one layer at a time ----------------------------------->
---
layout: true
class: left, top

## Building plots one layer at a time `r icon::fa("layer-group", pull="left")`

---
.left-code[
```{r gg-canvas1, fig.show="hide"}
ggplot(iris)
```

### Data

]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas1", "svg")`)
]

---
.left-code[
```{r gg-canvas2, fig.show="hide"}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) 
  
```

#### Data
### Aesthetics

]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas2", "svg")`)
]

---
.left-code[
```{r gg-canvas3, fig.show="hide"}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    {{geom_point() }}
```

#### Data
#### Aesthetics
### Geometries
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas3", "svg")`)
]

---
.left-code[
```{r gg-canvas4, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
   {{scale_color_brewer(palette="Dark2") }}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
### Scales
]
.pull-right[]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas4", "svg")`)
]

---
.left-code[
```{r gg-canvas5, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
   {{stat_summary(fun.y="mean", geom= "line") }}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
### Statistical transformations
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas5", "svg")`)
]

---
.left-code[
```{r gg-canvas6, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
   {{coord_flip()}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
### Coordinate systems
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas6", "svg")`)
]

---
.left-code[
```{r gg-canvas7, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
   {{facet_wrap(~Species)}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
### Facets
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas7", "svg")`)
]

---
.left-code[
```{r gg-canvas8, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
   {{theme_bw() + theme(legend.position="top")}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
### Themes
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas8", "svg")`)
]

---
.left-code[
```{r gg-canvas9, fig.show="hide", tidy=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
    theme_bw() + theme(legend.position="top") +
   {{annotate("text", x=7.5, y=2.5, label="Pval")}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
#### Themes
### Annotation
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas9", "svg")`)
]


<!---------------------------------------- GGPLOT2 BASICS ----------------------------------->
---
layout: false
class: inverse, middle, center
# Let's take a deeper look!

---
layout: true
class: left, top

## Basic `ggplot2` `r icon::fa("pencil-alt", pull="left")` 

---
class: highlight

.left-code[
```{r, eval=FALSE}
ggplot(iris)
```

### Data

]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas1", "svg")`)
]

---

.left-column[

## Data
`ggplot()`

]

.right-column[

The first step for plotting is having your data in a __tidy__ (aka long) format. What does this mean?

1. Each __variable__ forms a __column__.
2. Each __observation__ forms a __row__.

.pull-left[

#### Wide format (messy) `r icon::fa("times-circle", color="#DC143C	", pull="left")`

Drug | Response.CTRL | Response.T1D
-----|---------------|----------------
A	| 3	| 12
B | 6 |	56
C	| 8 |	2

]

.pull-right[

#### Long format (tidy) `r icon::fa("check-circle", color="#6B8E23", pull="left")`

Drug | Patient | Response
-----|---------|----------
A |	CTRL | 3
B	| CTRL | 6
C | CTRL | 8
A	| T1D	| 23
B	| T1D	| 56
C	| T1D	| 2
]
]

---
.left-column[
## Data
`ggplot()`
]

.right-column[

The first step for plotting is having your data in a __tidy__ (aka long) format. What does this mean?

1. Each __variable__ forms a __column__.
2. Each __observation__ forms a __row__.

You can convert data from **wide** to **long** format using `reshape2::melt()`
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) 
  
```

#### Data
### Aesthetics

]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas2", "svg")`)
]
---
.left-column[
### Data
## Aesthetics
`aes()`
]

.right-column[
The __aesthetics__ argument indicates how we map the data columns to visual elements or parameters.

- Variable 1 → **x**
- Variable 2 → **y**
- Variable 3 → **color**, fill, shape, etc.

All aesthetics need to be defined inside an `aes()` function.

You can define aesthetics for the 
- **whole plot** by including them in the `ggplot()` function.
- **specific geometry** by including them in the `geom_XXX()` function.
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    {{geom_point() }}
```

#### Data
#### Aesthetics
### Geometries
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas3", "svg")`)
]

---
.left-column[
### Data
### Aesthetics
## Geometries
`geom_*()`
]

.right-column[
The **geometries** indicate which geometric shapes should be plotted by using the parameters and variables defined in `aes()`.

```{r geom-point, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris, aes(Petal.Length, Petal.Width, color=Species)) +
  geom_point(size=.1) +
  theme_void() + theme(legend.position="none")
```

```{r geom-line, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris, aes(Petal.Length, Petal.Width, color=Species)) +
  stat_summary(fun.y="mean", geom="line") +
  theme_void() + theme(legend.position="none")
```

```{r geom-bar, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris[round(runif(70, min=1, max=nrow(iris))),], aes(Species, ..count.., fill=Species)) +
  geom_bar() +
  theme_void() + theme(legend.position="none")
```

```{r geom-hist, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris, aes(Petal.Length, fill=Species)) +
  geom_histogram() +
  theme_void() + theme(legend.position="none")
```

```{r geom-smooth, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris, aes(Petal.Length, Petal.Width, color=Species)) +
  geom_smooth() +
  theme_void() + theme(legend.position="none")
```

```{r geom-box, include=FALSE, fig.show="hide", fig.dim=c(1, .25), dev="svg"} 
ggplot(iris, aes(Species, Petal.Width, fill=Species, color=Species)) +
  geom_boxplot() +
  theme_void() + theme(legend.position="none")
```

Type       | Function           | Image
-----------|--------------------|-----------------------------------------------
Point      | `geom_point()`     | ![](`r knitr::fig_chunk("geom-point", "svg")`)
Line       | `geom_line()`      | ![](`r knitr::fig_chunk("geom-line", "svg")`)
Bar        | `geom_bar()`       | ![](`r knitr::fig_chunk("geom-bar", "svg")`)
Histogram  | `geom_histogram()` | ![](`r knitr::fig_chunk("geom-hist", "svg")`)
Regression | `geom_smooth()`    | ![](`r knitr::fig_chunk("geom-smooth", "svg")`)
Boxplot    | `geom_boxplot()`   | ![](`r knitr::fig_chunk("geom-box", "svg")`)
]

---
.left-column[
### Data
### Aesthetics
## Geometries
`geom_*()`
]

.right-column[
The **geometries** indicate which geometric shapes should be plotted by using the parameters and variables defined in `aes()`.

These are just some of all the available `geom_`:

```{r, echo=FALSE}
lsf.str("package:ggplot2") %>% grep("^geom_", ., value = TRUE)
```
]

---
layout: false
class: inverse, middle, center

# Time for some examples & exercises!

---
layout: true
class: left, top

## Hands on! `r icon::fa("laptop", pull="left")` 

---
.left-code[
### **Example 1**: Plot the _number of votes_ for each _TV series_ using boxplots

```{r example-1, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, num_votes)) +
  geom_boxplot()
```

]
.right-plot[
![](`r knitr::fig_chunk("example-1", "svg")`)
]

---
.left-code[
### **Example 2**: Plot the _number of votes per season_ for each _TV series_ using boxplots

```{r eval=FALSE}
ggplot(df,
       aes(tvseries_title, num_votes, 
           fill=season_number)) +
  geom_boxplot()
```
]
.right-plot[
![](`r knitr::fig_chunk("example-2", "svg")`)
]

---
.left-code[
### **Example 2**: Plot the _number of votes per season_ for each _TV series_ using boxplots

```{r example-2, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, num_votes, 
           fill=season_number)) +
  geom_boxplot()
```

This looks wrong... What is happening?

```{r, out.width="50%", fig.align="center", echo=FALSE}
knitr::include_graphics("https://media.giphy.com/media/d5Fc6QOUaBawLOxHbR/giphy.gif")
```

]
.right-plot[
![](`r knitr::fig_chunk("example-2", "svg")`)
]

---

.left-code[
### **Example 2**: Plot the _number of votes per season_ for each _TV series_ using boxplots

```{r example-2-corrected, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, num_votes, 
           fill=factor(season_number))) +
  geom_boxplot()
```

Some geometries need **discrete values**. As `season_number` is a `numerical` variable, ggplot2 considers it a `continuous` variable. We need to factorize it so ggplot knows how to group the different values.

]
.right-plot[
![](`r knitr::fig_chunk("example-2-corrected", "svg")`)
]

---
class: highlight

### **Exercise 1**:  Plot the _average ratings_ for each _TV series_ using boxplots

### **Exercise 2**: Plot the _average ratings per season_ for each _TV series_ using boxplots

### **Exercise 3**: Plot the distribution of _average ratings_ for each _TV series_ using violin plots and boxplots

Using the plots you generated, try to answer the following questions:

- #### Which is the highest rated TV show?
- #### Sequels are never any good?

---

.left-code[
### **Example 3**: Plot the _number of episodes_ for each _TV series_ using barplots

```{r example-3, fig.show="hide"}
ggplot(df,
       aes(tvseries_title,
           fill=factor(season_number))) +
  geom_bar(stat="count", color="black")
```
]
.right-plot[
![](`r knitr::fig_chunk("example-3", "svg")`)
]

---

.left-code[
### **Example 3**: Plot the _number of episodes_ for each _TV series_ using barplots

```{r example-3a, fig.show="hide"}
ggplot(df,
       aes(tvseries_title,
           fill=factor(season_number))) +
  geom_bar(stat="count", color="black", 
           position="fill")
```
]
.right-plot[
![](`r knitr::fig_chunk("example-3a", "svg")`)
]

---

.left-code[
### **Example 3**: Plot the _number of episodes_ for each _TV series_ using barplots

```{r example-3b, fig.show="hide"}
ggplot(df,
       aes(tvseries_title,
           fill=factor(season_number))) +
  geom_bar(stat="count", color="black", 
           position="dodge")
```
]
.right-plot[
![](`r knitr::fig_chunk("example-3b", "svg")`)
]

---
class: highlight

### **Exercise 4**: Plot the density of _average ratings_ for each _TV series_.

**Tip**: `geom_density()` is another example of a function that does not need a y aesthetic -- it automatically computes and draws the kernel density estimate. 

---
layout: false
class: inverse, middle, center

## Back to basics

---
layout: true
class: left, top

## Basic `ggplot2` `r icon::fa("pencil-alt", pull="left")` 

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
   {{scale_color_brewer(palette="Dark2")}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
### Scales
]
.pull-right[
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas4", "svg")`)
]


---
.left-column[
### Data
### Aesthetics
### Geometries
## Scales
`scale_*_*()`
]

.right-column[
Adjusts the scales for your different aesthetic paramaters:

`scale` + `<aes>` + `<type>`, where:

- `<aes>` indicates the parameter you want to modify (_y_, _color_, _shape_)
- `<type>` indicates what type of variable `<aes>` is (or the modification you want to perform).

Some examples:

- `scale_x_discrete()` allows you to modify your discrete __x axis__.
- `scale_y_continuous()` allows you to modify your continuous __y axis__. 
- `scale_color_manual()` if you want to manually adjust the __colors__ of your discrete variable.
- `scale_fill_gradient()` allows you to adjut the colors of your __fill__ gradient (for a continuous variable).
]

---
.left-column[
### Data
### Aesthetics
### Geometries
## Scales
`scale_*_*()`
]
.right-column[
Usually you will use **scales** to change the **color** and **fill** of your data. 

`ggplot2` has some built in color palettes and also provides wrapper functions to the [`RColorBrewer`](https://cran.r-project.org/web/packages/RColorBrewer/index.html) (`scale_fill_brewer`, `scale_color_brewer`). 

```{r, fig.dim=c(7,8), dev="png", out.width="50%", fig.align="center", echo=FALSE}
RColorBrewer::display.brewer.all()
```

]

---
.left-column[
### Data
### Aesthetics
### Geometries
## Scales
`scale_*_*()`
]
.right-column[
Usually you will use **scales** to change the **color** and **fill** of your data. 

`ggplot2` has some built in color palettes and also provides wrapper functions to the [`RColorBrewer`](https://cran.r-project.org/web/packages/RColorBrewer/index.html) (`scale_fill_brewer`, `scale_color_brewer`). 

There are additional R packages that provide more color palettes:

- **[`viridis`](https://github.com/sjmgarnier/viridis)**. color maps are designed in such a way that they will analytically be perfectly perceptually-uniform, both in regular form and also when converted to black-and-white. They are also designed to be perceived by readers with the most common form of color blindness. These re the new color maps from [Matplotib](https://matplotlib.org/).
- **[`ggsci`](https://github.com/nanxstats/ggsci)**. Offers a collection of ggplot2 color palettes inspired by scientific journals, data visualization libraries, science fiction movies, and TV shows.
- **[`gameoftrhones`](https://github.com/aljrico/gameofthrones)**. This package provides a round of palettes inspired by the Game of Thrones TV show.
- **[`palettetown`](https://github.com/timcdlucas/palettetown)**. An R package providing pokemon colour palettes.
]

---
layout: false
class: inverse, middle, center

# If you want to be a `ggplot2` wizard you need to customize your color scales!

```{r, out.width="40%", fig.align="center", echo=FALSE}
knitr::include_graphics("https://media.giphy.com/media/t9lPSqrGSc1IOnajTz/giphy.gif")
```

---
layout: true
class: left, top

## Hands on! `r icon::fa("laptop", pull="left")` 

---
.left-code[

### **Example 4**: This plot looks quite sad and wrong... Let's improve it by tweaking its scales!
```{r example-4, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, average_rating, 
           color=factor(season_number))) +
  geom_jitter() +
  geom_boxplot()
```

- Labels for the axis and legend are terrible.
- Default `ggplot2` colors.
- Difficult to interpret... Many different boxplot and data points.

]
.right-plot[
![](`r knitr::fig_chunk("example-4", "svg")`)
]

---
.left-code[

### **Example 4**: This plot looks quite sad and wrong... Let's improve it by tweaking its scales!
```{r example-4-corrected, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, average_rating)) +
  geom_jitter(aes(color=factor(season_number)),
              width=0.2, alpha=0.8) +
  geom_boxplot(fill=NA, width=0.5, outlier.shape=NA, 
               size=1) +
  scale_color_brewer(palette="RdPu", 
                     name="Season", 
                     labels=function(x) paste0("S0", 
                                               x)) +
  scale_y_continuous(name="Average Rating (IMDb)",
                     breaks=scales::pretty_breaks(),
                     limits=c(0,10)) +
  xlab("TV series title")
```

]
.right-plot[
![](`r knitr::fig_chunk("example-4-corrected", "svg")`)
]

---
class: highlight

.left-code[

### **Exercise 5**: Yet another sad plot... Try to improve it as much as you can!
```{r exercise-5, fig.show="hide"}
ggplot(df,
       aes(runtime_min, fill=tvseries_title)) +
  geom_density()
```
]
.right-plot[
![](`r knitr::fig_chunk("exercise-5", "svg")`)
]

---
layout: false
class: inverse, middle, center

## Time for more advanced functions!

---
layout: true
class: left, top

## Advanced `ggplot2` `r icon::fa("graduation-cap", pull="left")`

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
   {{stat_summary(fun.y="mean", geom= "line") }}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
### Statistical transformations
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas5", "svg")`)
]


---
.left-column[
## Statistical transformations
`stat_*()`
]

.right-column[
The `stat` functions and parameters perform statistical transformations on your data, for example:. 

- Plotting the **mean**  of your data points.
- Plotting the **standard error** of the mean of your data points.

```{r, fig.dim=c(5, 3), dev="svg", out.width="50%", fig.align="center"}
ggplot(iris, aes(Species, Petal.Width)) +
  geom_jitter(aes(color=Species)) +
  stat_summary(fun.y=mean, geom="point", size=4) +
  stat_summary(fun.data=mean_se, geom="errorbar")
```
]

---
.left-code[
### **Example 5**: Plot the _mean average ratings per season_ for each _TV series_.
```{r example-5, fig.show="hide"}
ggplot(df,
       aes(factor(season_number), average_rating,
           color=tvseries_title, 
           fill=tvseries_title)) +
  geom_jitter(width=0.2, alpha=0.5) +
  stat_summary(aes(group=tvseries_title), 
               fun.y=mean, geom="line",
               size=1) +
  stat_summary(fun.y=mean, geom="point", 
               size=4, pch=21, color="black") +
  palettetown::scale_color_poke(pokemon="charizard", 
                                name="TV series") +
  palettetown::scale_fill_poke(pokemon="charizard",
                               name="TV series") +
  xlab("Season number") + ylab("Average rating")
```  
]

.right-plot[
![](`r knitr::fig_chunk("example-5", "svg")`)  
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
   {{coord_flip()}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
### Coordinate systems
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas6", "svg")`)
]

---
.left-column[
### Statistical transformations
## Coordinate systems
`coord_*()`
]

.right-column[
The **coordinate systems** define how the x and y combine to position the elements in the plot. 

The default coordinate system is **cartesian** (`coord_cartesian()`) and several functions can modify it:
- `coord_fixed()` maintains the same "aspect ratio" for the x and y axis.
- `coord_flip()` flips the x and y coordinates.

You can also transform your da to polar coordinates using `coord_polar()`.
]

---
.left-code[
### **Example 6**: Zoom into an specific region of the plot.
```{r example-6, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=tvseries_title)) +
  scale_color_brewer(palette="Set1", 
                     name="TV series") +
  xlab("# of votes") + ylab("Average rating")
```  
]

.right-plot[
![](`r knitr::fig_chunk("example-6", "svg")`)  
]

---
.left-code[
### **Example 6**: Zoom into an specific region of the plot.
```{r example-6-corrected, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=tvseries_title)) +
  scale_color_brewer(palette="Set1", 
                     name="TV series") +
  xlab("# of votes") + ylab("Average rating") +
 {{coord_cartesian(xlim=c(0,500), ylim=c(7,9))}}
```  
]

.right-plot[
![](`r knitr::fig_chunk("example-6-corrected", "svg")`)  
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
   {{facet_wrap(~Species)}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
### Facets
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas7", "svg")`)
]

---
.left-column[
### Statistical transformations
### Coordinate systems
## Facets
`facet_*()`
]

.right-column[
Faceting generates different plots displaying different **subsets** of the data using a **discrete variable**.

There are two main functions for faceting:

- `facet_grid()`. Lay out panels in a grid using two discrete variables (`variable1 ~ variable2`).
- `facet_wrap()`. Creates a ribbon of panels displaying selecting the different values for your discrete variable.

]

---
.left-code[
### **Example 7**: Add classification according to the TV series title.
```{r example-7, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=factor(season_number))) +
  scale_color_brewer(palette="Set1", 
                     name="Season") +
  xlab("# of votes") + ylab("Average rating") +
  ylim(0,10)
```  
]

.right-plot[
![](`r knitr::fig_chunk("example-7", "svg")`)  
]


---
.left-code[
### **Example 7**: Add classification according to the TV series title.
```{r example-7-corrected, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=factor(season_number))) +
  scale_color_brewer(palette="Set1", 
                     name="Season") +
  xlab("# of votes") + ylab("Average rating") +
  ylim(0,10) +
 {{facet_wrap(~tvseries_title, scales="free_x")}}
```  
]

.right-plot[
![](`r knitr::fig_chunk("example-7-corrected", "svg")`)  
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
   {{theme_bw() + theme(legend.position="top")}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
### Themes
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas8", "svg")`)
]


---
.left-column[
### Statistical transformations
### Coordinate systems
### Facets
## Themes
`theme`
]

.right-column[
**Themes** allow you to tweak the overall look of the plot (only the elements that are not mapped to data).

#### Complete themes

You can find theme functions that change completely the look of the plot. Within `ggplot2` there are a few: `theme_bw()`, `theme_dark()`, `theme_gray()`, `theme_light()`, `theme_minimal()`.

There are additional packages that include other themes for `ggplot2`:

- [`ggthemes`](https://github.com/jrnold/ggthemes). Additional themes, scales, and geoms for ggplot2.
- [`tvthemes`](https://github.com/Ryo-N7/tvthemes). ggplot2 themes and palettes based on your favorite TV shows.
- [`hrbrthemes`](https://github.com/hrbrmstr/hrbrthemes/).  Opinionated, typographic-centric ggplot2 themes and theme components.
- [`vapoRwave`](https://github.com/moldach/vapoRwave/). Vaporwave themes and color palettes for ggplot2

**Complete themes** are a nice way of changing the overall look of your plot with one single function!
]

---
.left-column[
### Statistical transformations
### Coordinate systems
### Facets
## Themes
`theme`
]

.right-column[
**Themes** allow you to tweak the overall look of the plot (only the elements that are not mapped to data).

#### Specific theme elements
You can also change specific theme elements, such as the legend position, the size of the axis titles or the width of the axis lines by using the `theme()` function with the necessary arguments.

- `legend.position=c("none", "top", "right", "bottom", "left")`
- `axis.title=element_text(size=9)`
- `axis.line=element_line(size=2)`


You can check all the possible arguments you can pass to the `theme()` function [here](https://ggplot2.tidyverse.org/reference/theme.html).
]

---
.left-code[
### **Example 8**: Replace the default `ggplot2` theme for another one!
```{r example-8, eval=FALSE}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=tvseries_title)) +
  scale_color_brewer(palette="Set1", 
                     name="TV series") +
  xlab("# of votes") + ylab("Average rating")
```
]
.right-plot[
![](`r knitr::fig_chunk("example-6", "svg")`)  
]

---
.left-code[
### **Example 8**: Replace the default `ggplot2` theme for another one!
```{r example-8-corrected, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=tvseries_title)) +
  scale_color_brewer(palette="Set1", 
                     name="TV series") +
  xlab("# of votes") + ylab("Average rating") +
 {{theme_minimal()}}
```
]
.right-plot[
![](`r knitr::fig_chunk("example-8-corrected", "svg")`)  
]

---
.left-code[
### **Example 8**: Replace the default `ggplot2` theme for another one!
```{r example-8-corrected-b, fig.show="hide"}
ggplot(df,
       aes(num_votes, average_rating)) +
  geom_point(aes(color=tvseries_title), size=2) +
  tvthemes::scale_color_brooklyn99(palette = "Regular", 
                        name="TV series") +
  xlab("# of votes") + ylab("Average rating") +
 {{tvthemes::theme_brooklyn99()}}
```
]
.right-plot[
![](`r knitr::fig_chunk("example-8-corrected-b", "svg")`)  
]

---
.left-code[
### **Example 9**: Modify specific `theme()` elements so the plot looks nicer!
```{r example-9, eval=FALSE}
ggplot(df,
       aes(tvseries_title, average_rating)) +
  geom_jitter(aes(color=factor(season_number)),
              width=0.2, alpha=0.8) +
  geom_boxplot(fill=NA, width=0.5, outlier.shape=NA, 
               size=1) +
  scale_color_brewer(palette="RdPu", 
                     name="Season", 
                     labels=function(x) paste0("S0", 
                                               x)) +
  scale_y_continuous(name="Average Rating (IMDb)",
                     breaks=scales::pretty_breaks(),
                     limits=c(0,10)) +
  xlab("TV series title")
```
]
.right-plot[
![](`r knitr::fig_chunk("example-4-corrected", "svg")`)  
]

---
.left-code[
### **Example 9**: Modify specific `theme()` elements so the plot looks nicer!
```{r example-9-corrected, fig.show="hide"}
ggplot(df,
       aes(tvseries_title, average_rating)) +
  geom_jitter(aes(color=factor(season_number)),
              width=0.2, alpha=0.8) +
  geom_boxplot(fill=NA, width=0.5, outlier.shape=NA, 
               size=1) +
  scale_color_brewer(palette="RdPu", 
                     name="Season", 
                     labels=function(x) paste0("S0", 
                                               x)) +
  scale_y_continuous(name="Average Rating (IMDb)",
                     breaks=scales::pretty_breaks(),
                     limits=c(0,10)) +
  xlab("TV series title") +
  theme(axis.text.x=element_text(angle=30, hjust=1),
        panel.background=element_rect(fill="white"),
        axis.line=element_line(size=0.5),
        legend.position="top",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14))
```
]
.right-plot[
![](`r knitr::fig_chunk("example-9-corrected", "svg")`)  
]

---
class: highlight

.left-code[
```{r eval=FALSE}
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
    theme_bw() + theme(legend.position="top") +
   {{annotate("text", x=7.5, y=2.5, label="Pval")}}
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
#### Themes
### Annotation
]
]
.right-plot[
![](`r knitr::fig_chunk("gg-canvas9", "svg")`)
]

---
.left-column[
### Statistical transformations
### Coordinate systems
### Facets
### Themes
## Annotations
`annotate`
]

.right-column[
Allows annotation of different types of `geom` by manually inputing the x and y values for the annotation.

You just need to add the funcion `annotate()` with the `geom` you want to use and the `x` and `y` coordinates where it should be drawn.

If you have used `facet_*()` the annotation will be displayed in all the panels!
]

---
layout: false
class: inverse, middle, center

#### But that's not the end of it
# Expanding `ggplot2` with extensions

---
layout: true
class: top, left

## Expanding `ggplot2` `r icon::fa("expand-arrows-alt", pull="left")`

---
### Finding `ggplot2` extensions

Extensions add new functionalities, `geoms`, palettes and themes for `ggplot2`. 

.center[[ggplot2-exts.org](https://www.ggplot2-exts.org/)]

```{r, echo=FALSE, out.width="60%", fig.align="center"}
knitr::include_graphics("presentation_ggplot2_files/img/screenshot_ggplot2_extensions.png")
```

---
### Combined plots with `cowplot`

[`cowplot`](https://github.com/wilkelab/cowplot) provides various features that help with creating publication-quality figures:
- Set of themes
- Functions to align plots and arrange them into complex compound figures
- Functions that make it easy to annotate plots and or mix plots with images

The `cowplot` package provides the function `plot_grid()` to arrange plots into a grid and label them. More information can be found in the `cowplot` vignette ([here](https://wilkelab.org/cowplot/articles/introduction.html)).

.left-code[
```{r ex-cowplot, fig.show="hide", message=FALSE, fig.dim=c(5.5, 3)}
library(cowplot)

p1 <- ggplot(mtcars, aes(disp, mpg)) + 
  geom_point()
p2 <- ggplot(mtcars, aes(qsec, mpg)) +
  geom_point()

{{plot_grid(p1, p2, labels = c('A', 'B'))}}
```
]
.right-plot[
![](`r knitr::fig_chunk("ex-cowplot", "svg")`)
]

---
### Animated plots with `gganimate`

`gganimate` extends the grammar of graphics as implemented by ggplot2 to include the **description of animation**. It does this by providing a range of new grammar classes that can be added to the plot object in order to customise how it should change with time.

You can find more information on how to animate your ggplot2 plots in the vignette ([here](https://gganimate.com/articles/gganimate.html)).

.left-code[
```{r, eval=FALSE}
library(gganimate)
library(gapminder)

ggplot(gapminder, 
               aes(gdpPercap, lifeExp, 
                   size = pop, colour = country)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  facet_wrap(~continent) +
  # Here comes the gganimate specific bits
  labs(title = 'Year: {frame_time}', 
       x = 'GDP per capita', 
       y = 'life expectancy') +
  transition_time(year) +
  ease_aes('linear')
```

]
.right-plot[
```{r, echo=FALSE, out.width="75%"}
knitr::include_graphics("https://gganimate.com/reference/figures/README-unnamed-chunk-4-1.gif")
```
]

---
### Interactive plots with `ggiraph`
`ggiraph` is a tool that allows you to create **dynamic ggplot graphs**. This allows you to add tooltips, animations and JavaScript actions to the graphics.The package also allows the selection of graphical elements when used in shiny applications.

You can find more information on how to make your ggplot2 plots interactive in the vignette ([here](https://davidgohel.github.io/ggiraph/articles/offcran/using_ggiraph.html)).

.left-code[
```{r, eval=FALSE}
library(ggiraph)

gg_point <-  
  ggplot(mpg, 
         aes(displ, cty, color=hwy)) +
  theme_minimal() +
  geom_point_interactive(aes(tooltip = model, 
                             data_id = model), 
                         size = 2)
  
girafe(ggobj = gg_point)
```
]
.right-plot[
```{r, echo=FALSE}
library(ggiraph)

gg_point <-  
  ggplot(mpg, 
         aes(displ, cty, color=hwy)) +
  theme_minimal() +
  geom_point_interactive(aes(tooltip = model, 
                             data_id = model), 
                         size = 2)
  
h <- girafe(ggobj = gg_point, width_svg=6, height_svg=3)
htmlwidgets::saveWidget(h, file="ggiraph_ex.html")
```

<iframe src="ggiraph_ex.html" width = "600px", height = "3505px" frameBorder="0"></iframe> 

]

---
layout: false
class: left, top, highlight

## Hands on! `r icon::fa("laptop", pull="left")` 

### Play around with `ggplot2` themes & extensions and the `tvseries` dataset!

#### Remember, you can find a gallery of `ggplot2` extensions & themes at [www.ggplot2-exts.org](https://www.ggplot2-exts.org/)

```{r, out.width="25%", echo=FALSE, fig.align="center"}
knitr::include_graphics("https://media.giphy.com/media/3JVHxc37yo5g3pI5BE/giphy.gif")
```

### Share your amazing plots on twitter tagging `@RLadiesBCN`!

---
class: top, left

## Other `ggplot2` resources `r icon::fa("book", pull="left")`

- [`ggplot2`: Elegant Graphics for Data Analysis](https://ggplot2.tidyverse.org/reference/theme.html)
- [`ggplot2` documentation](https://ggplot2.tidyverse.org/reference/)
- [Data Visualization Cheat Sheet](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf)
- [R for Data Science](r4ds.had.co.nz)


## This workshop `r icon::fa("book-reader", pull="left")`

You can find the code for these slides & all course materials at [github.com/mireia-bioinfo/workshop_ggplot2](https://github.com/mireia-bioinfo/workshop_ggplot2)

These slides were created using the [xaringan](https://github.com/yihui/xaringan) R package with the R-Ladies themes.

---
class: inverse, center, middle

# The end

```{r, out.width="50%", echo=FALSE}
knitr::include_graphics("https://media.giphy.com/media/l4JySAWfMaY7w88sU/giphy.gif")
```

---
class: inverse, center, middle

# Let's test what you've learned today!

```{r, out.width="50%", echo=FALSE}
knitr::include_graphics("https://media.giphy.com/media/xThtalkAxYnZd94uB2/giphy.gif")
```

Go to

#[kahoot.it](https://kahoot.it/)