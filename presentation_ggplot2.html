<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Improve your plots with ggplot2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Mireia Ramos-Rodríguez" />
    <meta name="date" content="2019-10-11" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/rladies-fonts.css" rel="stylesheet" />
    <link href="libs/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Improve your plots with <code>ggplot2</code>
## ⚔<br/>R-Ladies Barcelona Workshop
### Mireia Ramos-Rodríguez
### 2019-10-11

---

class: inverse, center, middle




# What is `ggplot2`

---
class: left, top

## Why `ggplot2`?
**`ggplot2`** is a data visualization package for R developed by [Hadley Wickham](https://twitter.com/hadleywickham) that provides a structured approach to graphing. 

It is a part of the **`tidyverse`**, a collection of R packages that share an underlying design philosophy, grammar and data structures.

--

.pull-left[
### Pros
+ Standardized method for plotting.
+ Publication quality plots.
+ Allows creation of relatively complex plots with ease.
+ Dominant plotting package in R.

&lt;img src="https://media.giphy.com/media/nsMPhWK6bfxHq/giphy.gif" width="40%" style="display: block; margin: auto;" /&gt;
]

--

.pull-right[
### Cons
- Might be a little bit difficult to understand at the beginning.
- Sometimes you might get lost between all the things you can change.

&lt;img src="https://media.giphy.com/media/2FazgxLhFpYv4t93G/giphy.gif" width="40%" style="display: block; margin: auto;" /&gt;
]

---
class: inverse, center, middle

# The grammar of `ggplot2`

&lt;!---------------------------------------- BUILDING PLOTS one layer at a time -----------------------------------&gt;
---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris)
```

### Data

]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas1-1.svg)
]



---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) 
```

#### Data
### Aesthetics

]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas2-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
*    geom_point() 
```

#### Data
#### Aesthetics
### Geometries
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas3-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
*   scale_color_brewer(palette="Dark2") 
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
### Scales
]
.pull-right[]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas4-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
*   stat_summary(fun.y="mean", geom= "line") 
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
### Statistical transformations
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas5-1.svg)
]


---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
*   coord_flip()
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
### Coordinate systems
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas6-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
*   facet_wrap(~Species)
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
### Facets
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas7-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
*   theme_bw() + theme(legend.position="top")
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
### Themes
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas8-1.svg)
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
    theme_bw() + theme(legend.position="top") +
*   annotate("text", x=7.5, y=2.5, label="Pval")
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
#### Themes
### Annotation
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas9-1.svg)
]


&lt;!---------------------------------------- GGPLOT2 BASICS -----------------------------------&gt;
---
class: inverse, middle, center
# Let's take a deeper look!

---
class: left, top
## Building plots one layer at a time

.left-code[

```r
ggplot(iris)
```

### Data

]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas1-1.svg)
]

---
class: left, top

## `ggplot2` basics

.left-column[

## Data
`ggplot()`

]

.right-column[

The first step for plotting is having your data in a __tidy__ (aka long) format. What does this mean?

1. Each __variable__ forms a __column__.
2. Each __observation__ forms a __row__.

.pull-left[

#### Wide format (messy) <i class="fas  fa-times-circle fa-pull-left " style="color:#DC143C	;"></i>

Drug | Response.CTRL | Response.T1D
-----|---------------|----------------
A	| 3	| 12
B | 6 |	56
C	| 8 |	2

]

.pull-right[

#### Long format (tidy) <i class="fas  fa-check-circle fa-pull-left " style="color:#6B8E23;"></i>

Drug | Patient | Response
-----|---------|----------
A |	CTRL | 3
B	| CTRL | 6
C | CTRL | 8
A	| T1D	| 23
B	| T1D	| 56
C	| T1D	| 2
]
]

---
class: left, top

## `ggplot2` basics

.left-column[
## Data
`ggplot()`
]

.right-column[

The first step for plotting is having your data in a __tidy__ (aka long) format. What does this mean?

1. Each __variable__ forms a __column__.
2. Each __observation__ forms a __row__.

You can convert data from **wide** to **long** format using `reshape2::melt()`
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) 
```

#### Data
### Aesthetics

]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas2-1.svg)
]
---
class: left, top

## `ggplot2` basics

.left-column[
### Data
## Aesthetics
`aes()`
]

.right-column[
The __aesthetics__ argument indicates how we map the data columns to visual elements or parameters.

- Variable 1 → **x**
- Variable 2 → **y**
- Variable 3 → **color**, fill, shape, etc.

All aesthetics need to be defined inside an `aes()` function.

You can define aesthetics for the 
- **whole plot** by including them in the `ggplot()` function.
- **specific geometry** by including them in the `geom_XXX()` function.
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
*    geom_point() 
```

#### Data
#### Aesthetics
### Geometries
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas3-1.svg)
]

---
class: left, top

## `ggplot2` basics

.left-column[
### Data
### Aesthetics
## Geometries
`geom_*()`
]

.right-column[
The **geometries** indicate which geometric shapes should be plotted by using the parameters and variables defined in `aes()`.













Type       | Function           | Image
-----------|--------------------|-----------------------------------------------
Point      | `geom_point()`     | ![](presentation_ggplot2_files/figure-html/geom-point-1.svg)
Line       | `geom_line()`      | ![](presentation_ggplot2_files/figure-html/geom-line-1.svg)
Bar        | `geom_bar()`       | ![](presentation_ggplot2_files/figure-html/geom-bar-1.svg)
Histogram  | `geom_histogram()` | ![](presentation_ggplot2_files/figure-html/geom-hist-1.svg)
Regression | `geom_smooth()`    | ![](presentation_ggplot2_files/figure-html/geom-smooth-1.svg)
Boxplot    | `geom_boxplot()`   | ![](presentation_ggplot2_files/figure-html/geom-box-1.svg)
]

---
class: left, top

## `ggplot2` basics

.left-column[
### Data
### Aesthetics
## Geometries
`geom_*()`
]

.right-column[
The **geometries** indicate which geometric shapes should be plotted by using the parameters and variables defined in `aes()`.

These are just some of all the available `geom_`:


```
##  [1] "geom_abline"     "geom_area"       "geom_bar"       
##  [4] "geom_bin2d"      "geom_blank"      "geom_boxplot"   
##  [7] "geom_col"        "geom_contour"    "geom_count"     
## [10] "geom_crossbar"   "geom_curve"      "geom_density"   
## [13] "geom_density_2d" "geom_density2d"  "geom_dotplot"   
## [16] "geom_errorbar"   "geom_errorbarh"  "geom_freqpoly"  
## [19] "geom_hex"        "geom_histogram"  "geom_hline"     
## [22] "geom_jitter"     "geom_label"      "geom_line"      
## [25] "geom_linerange"  "geom_map"        "geom_path"      
## [28] "geom_point"      "geom_pointrange" "geom_polygon"   
## [31] "geom_qq"         "geom_qq_line"    "geom_quantile"  
## [34] "geom_raster"     "geom_rect"       "geom_ribbon"    
## [37] "geom_rug"        "geom_segment"    "geom_sf"        
## [40] "geom_sf_label"   "geom_sf_text"    "geom_smooth"    
## [43] "geom_spoke"      "geom_step"       "geom_text"      
## [46] "geom_tile"       "geom_violin"     "geom_vline"
```
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
*   scale_color_brewer(palette="Dark2") 
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
### Scales
]
.pull-right[]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas4-1.svg)
]


---
class: left, top

## `ggplot2` basics

.left-column[
### Data
### Aesthetics
### Geometries
## Scales
`scale_*_*()`
]

.right-column[
Adjusts the scales for your different aesthetic paramaters:

`scale` + `&lt;aes&gt;` + `&lt;type&gt;`, where:

- `&lt;aes&gt;` indicates the parameter you want to modify (_y_, _color_, _shape_)
- `&lt;type&gt;` indicates what type of variable `&lt;aes&gt;` is (or the modification you want to perform).

Some examples:

- `scale_x_discrete()` allows you to modify your discrete __x axis__.
- `scale_y_continuous()` allows you to modify your continuous __y axis__. 
- `scale_color_manual()` if you want to manually adjust the __colors__ of your discrete variable.
- `scale_fill_gradient()` allows you to adjut the colors of your __fill__ gradient (for a continuous variable).
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
*   stat_summary(fun.y="mean", geom= "line") 
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
### Statistical transformations
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas5-1.svg)
]


---
class: left, top

## Advanced `ggplot2`

.left-column[
## Statistical transformations
`stat_*()`
]

.right-column[
The `stat` functions and parameters perform statistical transformations on your data, for example:. 

- Plotting the **mean**  of your data points.
- Plotting the **standard error** of the mean of your data points.


```r
ggplot(iris, aes(Species, Petal.Width)) +
  geom_jitter(aes(color=Species)) +
  stat_summary(fun.y=mean, geom="point", size=4) +
  stat_summary(fun.data=mean_se, geom="errorbar")
```

&lt;img src="presentation_ggplot2_files/figure-html/unnamed-chunk-9-1.svg" width="50%" style="display: block; margin: auto;" /&gt;
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
*   coord_flip()
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
### Coordinate systems
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas6-1.svg)
]

---
class: left, top

## Advanced `ggplot2`

.left-column[
### Statistical transformations
## Coordinate systems
`coord_*()`
]

.right-column[
The **coordinate systems** define how the x and y combine to position the elements in the plot. 

The default coordinate system is **cartesian** (`coord_cartesian()`) and several functions can modify it:
- `coord_fixed()` maintains the same "aspect ratio" for the x and y axis.
- `coord_flip()` flips the x and y coordinates.

You can also transform your da to polar coordinates using `coord_polar()`.
]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
*   facet_wrap(~Species)
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
### Facets
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas7-1.svg)
]

---
class: left, top

## Advanced `ggplot2`

.left-column[
### Statistical transformations
### Coordinate systems
## Facets
`facet_*()`
]

.right-column[
Faceting generates different plots displaying different **subsets** of the data using a **discrete variable**.

There are two main functions for faceting:

- `facet_grid()`. Lay out panels in a grid using two discrete variables (`variable1 ~ variable2`).
- `facet_wrap()`. Creates a ribbon of panels displaying selecting the different values for your discrete variable.

]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
*   theme_bw() + theme(legend.position="top")
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
### Themes
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas8-1.svg)
]


---
class: left, top

## Advanced `ggplot2`

.left-column[
### Statistical transformations
### Coordinate systems
### Facets
## Themes
`theme`
]

.right-column[
**Themes** allow you to tweak the overall look of the plot (only the elements that are not mapped to data).

#### Complete themes

You can find theme functions that change completely the look of the plot. Within `ggplot2` there are a few: `theme_bw()`, `theme_dark()`, `theme_gray()`, `theme_light()`, `theme_minimal()`.

There are additional packages that include other themes for `ggplot2`:

- Missing
]

---
class: left, top

## Advanced `ggplot2`

.left-column[
### Statistical transformations
### Coordinate systems
### Facets
## Themes
`theme`
]

.right-column[
**Themes** allow you to tweak the overall look of the plot (only the elements that are not mapped to data).

#### Specific theme elements
You can also change specific theme elements, such as the legend position, the size of the axis titles or the width of the axis lines by using the `theme()` function with the necessary arguments.

- `legend.position=c("none", "top", "right", "bottom", "left")`
- `axis.title=element_text(size=9)`
- `axis.line=element_line(size=2)`

]

---
class: left, top

## Building plots one layer at a time

.left-code[

```r
ggplot(iris,
      aes(x=Sepal.Length, y=Sepal.Width, 
          color=Species)) +
    geom_point() +
    scale_color_brewer(palette="Dark2") +
    stat_summary(fun.y="mean", geom= "line") + 
    coord_flip() +
    facet_wrap(~Species) +
    theme_bw() + theme(legend.position="top") +
*   annotate("text", x=7.5, y=2.5, label="Pval")
```

.pull-left[
#### Data
#### Aesthetics
#### Geometries
#### Scales
]
.pull-right[
#### Statistical transformations
#### Coordinate systems
#### Facets
#### Themes
### Annotation
]
]
.right-plot[
![](presentation_ggplot2_files/figure-html/gg-canvas9-1.svg)
]

---
class: left, top

## Advanced `ggplot2`

.left-column[
### Statistical transformations
### Coordinate systems
### Facets
### Themes
## Annotations
`annotate`
]

.right-column[
Allows annotation of different types of `geom` by manually inputing the x and y values for the annotation.

If you have used `facet_*()` the annotation will be displayed in all the panels!
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
